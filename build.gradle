plugins{
	id 'com.github.kt3k.coveralls' version '2.6.3'
}

allprojects {
	apply plugin: 'eclipse'
}

project(':server'){
	apply plugin: 'war'
	apply plugin: 'java'
	apply from: 'https://raw.github.com/akhikhl/gretty/master/pluginScripts/gretty.plugin'
	apply plugin: 'java'
	apply plugin: 'jacoco'

	check.dependsOn {
		project(':server').jacocoTestReport
	}
	jacocoTestReport {
		afterEvaluate {
			classDirectories = files(classDirectories.files.collect {
			fileTree(dir: it, exclude: 'META-INF/**')
			}
		)}
		reports {
       			 xml.enabled true
       			 csv.enabled false
       			 html.destination "${buildDir}/jacocoHtml"
   		 }
	}
}

project(':dtos'){
	apply plugin: 'java'
}

project(':android'){
	apply plugin: 'java'
}
task codeCoverageReport(type: JacocoReport) {

    // Gather execution data from all subprojects
    // (change this if you e.g. want to calculate unit test/integration test coverage separately)
    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    // Add all relevant sourcesets from the subprojects 
    subprojects.each {
       sourceSets it.sourceSets.main
    }

    reports {
      xml.enabled true
      html.enabled true
      html.destination "${buildDir}/reports/jacoco"
      csv.enabled false
    }
}

// always run the tests before generating the report
codeCoverageReport.dependsOn {
    subprojects*.test
}

