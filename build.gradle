allprojects {
	apply plugin: 'eclipse'
}

project(':server'){
	apply plugin: 'war'
	apply plugin: 'java'
	apply from: 'https://raw.github.com/akhikhl/gretty/master/pluginScripts/gretty.plugin'

	apply plugin: 'java'
	
	apply plugin: 'jacoco'
	jacocoTestReport {
	    reports {
		xml.enabled false
		csv.enabled false
		html.destination "${buildDir}/jacocoHtml"
	    }
	}
	test {
	    jacoco {
		append = false
		destinationFile = file("$buildDir/jacoco/jacocoTest.exec")
		classDumpFile = file("$buildDir/jacoco/classpathdumps")
	    }
	}

	jacocoTestReport {
	    afterEvaluate {
		classDirectories = files(classDirectories.files.collect {
		    fileTree(dir: it, exclude: 'META-INF/**')
		})
	    }
	}




	dependencies {
		compile project(':dtos')
		testCompile group: 'org.assertj', name: 'assertj-core', version: '3.+'
		testCompile group: 'junit', name: 'junit', version: '4.+'
	}
}

project(':dtos'){
	apply plugin: 'java'
}

project(':android'){
	apply plugin: 'java'
}


task codeCoverageReport(type: JacocoReport) {
    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    subprojects.each {
        sourceSets it.sourceSets.main
    }

    reports {
        xml.enabled true
        xml.destination "${buildDir}/reports/jacoco/report.xml"
        html.enabled false
        csv.enabled false
    }
}

codeCoverageReport.dependsOn {
    subprojects*.test
}
